{"remainingRequest":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\login\\ResetPasswords.vue?vue&type=style&index=0&id=028b8750&lang=css&","dependencies":[{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\login\\ResetPasswords.vue","mtime":1681468306523},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\nbody {\r\n    background-image:url(~@/assets/images/login_background.png);\r\n    background-repeat: no-repeat;\r\n    background-size: cover;\r\n    -webkit-background-size: cover;\r\n    background-position: center 0;\r\n}\r\n",{"version":3,"sources":["ResetPasswords.vue"],"names":[],"mappings":";AAsTA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ResetPasswords.vue","sourceRoot":"src/view/login","sourcesContent":["<template>\r\n<div>\r\n  <Row type=\"flex\" justify=\"center\" align=\"middle\" class=\"code-row-bg\" style=\"margin-top:5%\">\r\n    <Col span=\"12\" >\r\n      <Card :shadow=\"false\" :padding=\"40\" class=\"login\" style=\"background: rgb(255, 255, 255,0.9);\">\r\n        <Form ref=\"formBean\" :model=\"formBean\" :labelWidth=\"50\" :rules=\"formRule\">\r\n          <Row>\r\n            <!-- <p style=\"height: 32px;font-size:14px;text-align:left;font-weight: bold;\">您好{{userName}}：</p> -->\r\n            <p style=\"height: 32px;font-size:14px;text-align:left;font-weight: bold;\">密码重置</p>\r\n          </Row>\r\n          <Row>\r\n            <!-- <Col span=\"15\">\r\n              <FormItem prop=\"empId\">\r\n                <Input v-model=\"formBean.empId\" style=\"width:100%\">\r\n                  <span slot=\"prepend\" style=\"display: inline-block;width:70px\">工号：</span>\r\n                </Input>\r\n              </FormItem>\r\n            </Col> -->\r\n            <Col span=\"15\">\r\n              <FormItem prop=\"userCode\">\r\n                <Input v-model=\"formBean.userCode\" style=\"width:100%\">\r\n                  <span slot=\"prepend\" style=\"display: inline-block;width:70px\">账号：</span>\r\n                </Input>\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"1\">\r\n              <FormItem prop=\"userCode\">\r\n                <Button type=\"primary\" style=\"margin-left:0\" @click=\"searchMessage\">查询</Button>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <div v-if=\"isSearch\">\r\n          <Row>\r\n          </Row>\r\n          <Row>\r\n            <Col span=\"15\">\r\n              <FormItem prop=\"userName\">\r\n                <Input v-model=\"formBean.userName\" readonly>\r\n                  <span slot=\"prepend\" style=\"display: inline-block;width:70px\">中文名：</span>\r\n                </Input>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row>\r\n            <Col span=\"15\">\r\n              <FormItem prop=\"userEmail\">\r\n                <Input v-model=\"formBean.userEmail\" readonly>\r\n                  <span slot=\"prepend\" style=\"display: inline-block;width:70px\">邮箱：</span>\r\n                </Input>\r\n              </FormItem>\r\n            </Col>\r\n            <Col span=\"1\">\r\n              <FormItem prop=\"userEmail\">\r\n                <Button id=\"getCode_btn\" :disabled=\"getCode_btn\" type=\"primary\" @click=\"getCode\">{{codeMessage}}</Button>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row>\r\n            <Col span=\"15\">\r\n              <FormItem prop=\"code\">\r\n                <Input v-model=\"formBean.code\">\r\n                  <span slot=\"prepend\" style=\"display: inline-block;width:70px\">验证码：</span>\r\n                </Input>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row>\r\n            <Col span=\"15\">\r\n              <FormItem prop=\"newPassword\">\r\n                <Input type=\"password\" v-model=\"formBean.newPassword\">\r\n                  <span slot=\"prepend\" style=\"display: inline-block;width:70px\">新密码：</span>\r\n                </Input>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          <Row>\r\n            <Col span=\"15\">\r\n              <FormItem prop=\"newPassword2\">\r\n                <Input type=\"password\" v-model=\"formBean.newPassword2\">\r\n                  <span slot=\"prepend\" style=\"display: inline-block;width:70px\">确认密码：</span>\r\n                </Input>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n          </div>\r\n          <Row>\r\n            <Col span=\"12\">\r\n              <FormItem>\r\n                  <Button @click=\"Cancel\" style=\"margin-left: 20px;float: right;\">取消</Button>\r\n                  <Button :disabled=\"isview\" type=\"primary\" :loading=\"loading\" @click=\"Submit\" style=\"float: right;\">确定</Button>\r\n              </FormItem>\r\n            </Col>\r\n          </Row>\r\n        </Form>\r\n      </Card>\r\n    </Col>\r\n  </Row>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport utils from '@/common/utils'\r\nimport { mapActions } from 'vuex'\r\n\r\nexport default {\r\n  data () {\r\n    return {\r\n      countdown: '',\r\n      codeMessage: '获取验证码',\r\n      getCode_btn: false,\r\n      isSearch: false,\r\n      formBean: {},\r\n      modulus: '',\r\n      exponent: '',\r\n      key: '',\r\n      loading: false,\r\n      isview: true,\r\n      confirm: {\r\n        show: false\r\n      },\r\n      formRule: {\r\n        code: [{ required: true, message: '请输入验证码！' }],\r\n        newPassword: [{ required: true, message: '请输入密码！' }],\r\n        newPassword2: [{ required: true, message: '请确认密码！' }]\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions([\r\n      'handleLogOut'\r\n    ]),\r\n    Submit () {\r\n      this.$refs.formBean.validate(valid => {\r\n        if (!valid) return\r\n        if (this.formBean.newPassword === this.formBean.newPassword2) {\r\n          var pwreg = /^(?![S|s]pdb.123)(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[`~!@#$%^&*()_+<>?:\"{},.;'\\/[\\]\\|\\\\=-]).*$/\r\n          if (pwreg.test(this.formBean.newPassword)) {\r\n            let params = {}\r\n            Object.assign(params, this.formBean)\r\n            // 更新是否需要修改密码字段 if_modify_pass=0\r\n            params.isModifyPwd = 0\r\n            let httpConfig = {\r\n              method: 'POST',\r\n              url: '/user/forgotPwd',\r\n              data: params\r\n            }\r\n            this.loading = true\r\n            this.isview = true\r\n            this.$ajax(httpConfig).then(resp => {\r\n              if (resp.data === 'success') {\r\n                this.$Message.success('修改成功！将自动跳转到登陆页面...')\r\n                setTimeout(function () { utils.logout(this.$router) }, 1000)\r\n              } else if (resp.data === 'codefail') {\r\n                this.$Message.error({\r\n                  content: '验证码错误或失效，修改失败！',\r\n                  duration: 8,\r\n                  closable: true\r\n                })\r\n                this.loading = false\r\n                this.isview = false\r\n              } else {\r\n                this.$Message.error('修改失败！')\r\n                this.loading = false\r\n                this.isview = false\r\n              }\r\n            })\r\n          } else {\r\n            this.$Message.error('密码不符合规则,必须是字母数组和特殊字符组合！')\r\n          }\r\n        } else {\r\n          this.$Message.error('两次输入密码不同！')\r\n        }\r\n      })\r\n    },\r\n    searchMessage () {\r\n      if (!this.formBean.userCode) {\r\n        this.$Message.error('请输入账号后查询')\r\n      }\r\n      let param = {}\r\n      param.userCode = this.formBean.userCode\r\n      let loadConfig = {\r\n        method: 'GET',\r\n        url: '/user/selectUserToCode',\r\n        params: param\r\n      }\r\n      this.isSearch = false\r\n      this.isview = true\r\n      this.$ajax(loadConfig)\r\n        .then(resp => {\r\n          if (resp.status && resp.status === 200) {\r\n            // console.log(resp)\r\n            if (resp.data.length === 0) {\r\n              this.$Message.warning({\r\n                content: '当前账号不存在或停用,请确认账号或联系管理员',\r\n                duration: 8,\r\n                closable: true\r\n              })\r\n              // this.$Message.warning('当前工号不存在或停用,请确认工号或联系管理员')\r\n            } else {\r\n              this.isSearch = true\r\n              this.isview = false\r\n              this.formBean = resp.data\r\n              // this.formBean.empId = resp.data.emp_id\r\n            }\r\n          }\r\n        })\r\n    },\r\n    getCode () {\r\n      if (!this.formBean.userEmail) {\r\n        this.$Message.warning({\r\n          content: '当前账号未配置邮箱，请联系管理员',\r\n          duration: 8,\r\n          closable: true\r\n        })\r\n        return\r\n      }\r\n      let cookieV = this.getCookieValue('secondsremained') ? this.getCookieValue('secondsremained') : 0\r\n      if (cookieV > 0) {\r\n        this.settime()\r\n        this.$Message.info({\r\n          content: '请检查您的邮箱，查看是否收到验证码',\r\n          duration: 8,\r\n          closable: true\r\n        })\r\n      } else {\r\n        let param = {}\r\n        Object.assign(param, this.formBean)\r\n        let loadConfig = {\r\n          method: 'POST',\r\n          url: '/user/sendvaricode',\r\n          data: param\r\n        }\r\n        this.$ajax(loadConfig)\r\n          .then(resp => {\r\n            if (resp.status && resp.status === 200) {\r\n              if (resp.data) {\r\n                this.getCode_btn = true\r\n                this.addCookie('secondsremained', 60, 60)\r\n                this.settime()\r\n              } else {\r\n                this.$Message.error({\r\n                  content: '验证码发送失败！',\r\n                  duration: 8,\r\n                  closable: true\r\n                })\r\n              }\r\n            }\r\n          })\r\n      }\r\n    },\r\n    addCookie (name, value, expiresHours) {\r\n      let cookieString = name + '=' + escape(value)\r\n      if (expiresHours > 0) {\r\n        let date = new Date()\r\n        date.setTime(date.getTime() + expiresHours * 1000)\r\n        cookieString = cookieString + ';expires=' + date.toUTCString()\r\n      }\r\n      document.cookie = cookieString\r\n    },\r\n    getCookieValue (name) {\r\n      let strCookie = document.cookie\r\n      let arrCokie = strCookie.split(';')\r\n      let result = ''\r\n      arrCokie.forEach((d, i) => {\r\n        let arr = d.split('=')\r\n        if (arr[0].replace(/\\s*/g, '') === name) {\r\n          result = unescape(arr[1])\r\n        }\r\n      })\r\n      return result\r\n    },\r\n    settime () {\r\n      let countdown = this.getCookieValue('secondsremained')\r\n      let that = this\r\n      let tim = setInterval(function () {\r\n        countdown--\r\n        that.codeMessage = '重新发送(' + countdown + ')'\r\n        that.getCode_btn = true\r\n        if (countdown <= 0) {\r\n          clearInterval(tim)\r\n          that.getCode_btn = false\r\n          that.codeMessage = '重新发送'\r\n        }\r\n        that.editCookie('secondsremained', countdown, countdown + 1)\r\n      }, 1000)\r\n    },\r\n    editCookie (name, value, expiresHours) {\r\n      let cookieString = name + '=' + escape(value)\r\n      if (expiresHours > 0) {\r\n        let date = new Date()\r\n        date.setTime(date.getTime() + expiresHours * 1000)\r\n        cookieString = cookieString + ';expires=' + date.toGMTString()\r\n      }\r\n      document.cookie = cookieString\r\n    },\r\n    Cancel () {\r\n      this.$router.push({ name: 'login' })\r\n    }\r\n  },\r\n  mounted () {\r\n\t  // this.confirm.show = true\r\n    // this.userName = this.$route.query.userName\r\n    // this.userId = this.$route.query.userId\r\n    // if (env.enableVerifyPass) {\r\n    //   this.getKey()\r\n    // }\r\n  }\r\n}\r\n</script>\r\n<style>\r\nbody {\r\n    background-image:url(~@/assets/images/login_background.png);\r\n    background-repeat: no-repeat;\r\n    background-size: cover;\r\n    -webkit-background-size: cover;\r\n    background-position: center 0;\r\n}\r\n</style>"]}]}