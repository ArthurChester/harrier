{"remainingRequest":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\spdb\\job\\jobList\\Dep.vue?vue&type=style&index=0&id=f0011f94&lang=css&","dependencies":[{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\spdb\\job\\jobList\\Dep.vue","mtime":1681468306534},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\n#depTable table td div{\r\n\t/* padding-left: 5px;\r\n\tpadding-right: 0; */\r\n}\r\n#depTable table th div{\r\n\t/* padding-left: 5px;\r\n\tpadding-right: 0; */\r\n}\r\n#confirmDep .ivu-modal-body{\r\n\tpadding: 16px;\r\n  font-size:14px;\r\n  line-height:1.5;\r\n  width: 100%;\r\n}\r\n",{"version":3,"sources":["Dep.vue"],"names":[],"mappings":";AAqjBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Dep.vue","sourceRoot":"src/view/spdb/job/jobList","sourcesContent":["<template>\r\n\t<div>\r\n\t\t<div>\r\n\t\t\t<!-- <Button type=\"primary\" icon=\"android-add\" @click=\"save\">保存</Button> -->\r\n\t\t\t<Row>\r\n\t\t\t\t<Col span=\"20\">\r\n\t\t\t\t\t<div style=\"font-size:14px;font-weight: bold; color: #464c5b;margin-left:5px;\">依赖作业列表\r\n\t\t\t\t\t&nbsp;&nbsp;平台名:{{this.transData.jobData.platform}}\r\n\t\t\t\t\t&nbsp;&nbsp;应用名:{{this.transData.jobData.systems}}\r\n\t\t\t\t\t&nbsp;&nbsp;作业名:{{this.transData.jobData.job}}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</Col>\r\n\t\t\t\t<Col span=\"4\">\r\n\t\t\t\t\t<!-- <Button size=\"small\" type=\"primary\" icon=\"md-cloud-download\" @click=\"download\" style=\"\">下载</Button> -->\r\n\t\t\t\t\t<Button size=\"small\" type=\"primary\" icon=\"ios-arrow-back\" @click=\"cancel\" style=\"\">返回</Button>\r\n\t\t\t\t</Col>\r\n\t\t\t</Row>\r\n\t\t</div>\r\n\t\t<div class=\"spdb-table\" id=\"depTable\">\r\n\t\t\t<Table border :columns=\"gridColumns\" :data=\"gridData\" stripe @on-sort-change=\"changeSort\">\r\n\t\t\t</Table>\r\n\t\t</div>\r\n\t\t<div class=\"spdb-page\">\r\n\t\t\t<Page :total=\"page.total\" :current=\"page.current\" :page-size=\"page.size\" :page-size-opts=\"page.opt\" show-total show-sizer show-elevat show-elevator @on-change=\"changePage\" @on-page-size-change=\"changePageSize\"></Page>\r\n\t\t</div>\r\n\t\t<Modal id=\"confirmDep\"\r\n\t\t\tv-model=\"depDlg.show\"\r\n\t\t\ttitle=\"修改依赖状态\"\r\n\t\t\t@on-ok=\"depOk\">\r\n\t\t\t<div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<Form :label-width=\"90\" >\r\n\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t<FormItem label=\"平台名\">\r\n\t\t\t\t\t\t\t\t<Input readonly v-model=\"formBean.depPlatform\"/>\r\n\t\t\t\t\t\t\t</FormItem>\r\n\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t<FormItem label=\"应用名\">\r\n\t\t\t\t\t\t\t\t<Input readonly v-model=\"formBean.depSystem\"/>\r\n\t\t\t\t\t\t\t</FormItem>\r\n\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t<FormItem label=\"作业名\">\r\n\t\t\t\t\t\t\t\t<Input readonly type=\"textarea\" :autosize=\"{minRows: 1,maxRows: 5}\" v-model=\"formBean.depJob\"/>\r\n\t\t\t\t\t\t\t</FormItem>\r\n\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t<FormItem label=\"是否启用\">\r\n\t\t\t\t\t\t\t\t<RadioGroup v-model=\"formBean.isEnable\">\r\n\t\t\t\t\t\t\t\t\t<Radio label='1'><span>启用</span></Radio>\r\n\t\t\t\t\t\t\t\t\t<Radio label='0'><span>禁用</span></Radio>\r\n\t\t\t\t\t\t\t\t</RadioGroup>\r\n\t\t\t\t\t\t\t</FormItem>\r\n\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t<Row>\r\n\t\t\t\t\t\t\t<FormItem label=\"依赖批次号\">\r\n\t\t\t\t\t\t\t\t<!-- <InputNumber :max=\"10000\" :min=\"0\" v-model=\"formBean.depBatch\"></InputNumber> -->\r\n\t\t\t\t\t\t\t\t<Input readonly v-model=\"formBean.depBatch\"/>\r\n\t\t\t\t\t\t\t</FormItem>\r\n\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t</Form>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</Modal>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport utils from '@/common/utils'\r\nconst RESOURCE_PATH = '/udsJob'\r\nexport default {\r\n  props: {\r\n    transData: {\r\n      type: Object,\r\n      default: function () {\r\n    \t\t\treturn {}\r\n      }\r\n    }\r\n  \t},\r\n  data () {\r\n    return {\r\n      depDlg: { show: false, index: '' },\r\n      formBean: {},\r\n      gridData: [],\r\n      gridColumns: [\r\n        /** {\r\n\t\t\t\t\ttype: 'selection',\r\n\t\t\t\t\twidth: 60,\r\n\t\t\t\t\t//align: 'center',\r\n\t\t\t\t\tfixed: 'left'\r\n\t\t\t\t}, */\r\n        {\r\n          title: '平台名',\r\n          sortable: true,\r\n          width: 100,\r\n          key: 'platform'\r\n        },\r\n        {\r\n          title: '应用名',\r\n          sortable: true,\r\n          width: 100,\r\n          key: 'systems'\r\n        },\r\n        {\r\n          title: '作业名',\r\n          sortable: true,\r\n          minWidth: 200,\r\n          key: 'job',\r\n          render: (h, { column, index, row }) => {\r\n            return h('div', [\r\n              h('a', {\r\n                props: {\r\n                  size: 'small',\r\n                  type: 'info'\r\n                },\r\n                style: {\r\n                  // marginRight: '5px'\r\n                  // color: \"green\"\r\n                  // color: row.isEnable === 0 ? 'red' : ''\r\n                },\r\n                on: {\r\n                  click: () => {\r\n                    let id = row.job\r\n                    let queryCache = { id: id, statusName: 'jobdetail', jobData: row, previd: this.transData.id, prevTab: 'dep', curTab: 'dep', tablePage: this.tablePage, formBean: this.transData.formBean }\r\n                    if (this.transData.jobStatus) {\r\n                      queryCache.jobStatus = this.transData.jobStatus\r\n                      this.$emit('switch', Object.assign({}, queryCache, this.getPageParam())) // 提交form事件，在parent中显示form\r\n                    } else {\r\n                      this.$emit('switch', Object.assign({}, queryCache, this.getPageParam())) // 提交form事件，在parent中显示form\r\n                    }\r\n                  }\r\n                }\r\n              }, row.job)\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '执行节点',\r\n          minWidth: 120,\r\n          key: 'serverName'\r\n        },\r\n        {\r\n          title: '类型',\r\n          sortable: true,\r\n          width: 90,\r\n          key: 'jobType',\r\n          render: (h, { column, index, row }) => {\r\n            return h('div', [\r\n              h('a', {\r\n                props: {\r\n                  size: 'small',\r\n                  type: 'info'\r\n                },\r\n                style: {\r\n                  marginRight: '5px',\r\n                  color: '#3399ff'\r\n                },\r\n                on: {\r\n                  click: () => {\r\n                    let id = row.job\r\n                    let queryCache = { formBean: this.transData.formBean, currentPage: this.transData.currentPage, pageSize: this.transData.pageSize, page: this.page }\r\n                    if (this.transData.prequeryCache) {\r\n                      queryCache = this.transData.prequeryCache\r\n                    }\r\n                    if (row.jobType == 'M' || row.jobType == 'W') {\r\n                      this.$emit('switch', Object.assign({}, { id: id, previd: this.transData.id, statusName: 'frequency', prevTab: 'dep', curTab: 'dep', jobData: row }, this.getPageParam()))\r\n                    } else if (row.jobType == 'C') {\r\n                      this.$emit('switch', Object.assign({}, { id: id, previd: this.transData.id, statusName: 'trigger', prevTab: 'dep', curTab: 'dep', jobData: row }, this.getPageParam()))\r\n                      // this.$emit('switch', Object.assign({}, {id: id, statusName: 'trigger', jobData: row}, this.getPageParam()))\r\n                    } else {\r\n                      this.$Message.warning('日作业不存在定时或频度信息。')\r\n                    }\r\n                  }\r\n                }\r\n              }, this.jobtypeList[row.jobType])\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '状态',\r\n          sortable: true,\r\n          width: 110,\r\n          key: 'lastStatus'\r\n        },\r\n        {\r\n          title: '依赖批次号',\r\n          sortable: true,\r\n          width: 130,\r\n          key: 'depBatch'\r\n        },\r\n        {\r\n          title: '开始时间',\r\n          sortable: true,\r\n          width: 175,\r\n          key: 'startTime'\r\n        },\r\n        {\r\n          title: '结束时间',\r\n          sortable: true,\r\n          width: 175,\r\n          key: 'endTime',\r\n          render: (h, { column, index, row }) => {\r\n            return h('div', [\r\n              h('span', {\r\n                props: {\r\n                  size: 'small',\r\n                  type: 'info'\r\n                },\r\n                style: {\r\n                  // marginRight: '5px'\r\n                }\r\n              }, row.lastStatus == 'Running' ? '' : row.endTime)\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: 'TXDate',\r\n          sortable: true,\r\n          width: 120,\r\n          key: 'jobDate'\r\n        },\r\n        {\r\n          title: '描述',\r\n          minWidth: 80,\r\n          key: 'des'\r\n        },\r\n        {\r\n          title: '依赖状态',\r\n          width: 100,\r\n          // fixed: 'right',\r\n          key: 'isEnable',\r\n          render: (h, { column, index, row }) => {\r\n            let statusc = '#19be6b'\r\n            if (row.isEnable == '0') {\r\n              statusc = '#ed3f14'\r\n            }\r\n            return h('div', [\r\n              h('span', {\r\n                props: {\r\n                  size: 'small',\r\n                  type: 'info'\r\n                },\r\n                style: {\r\n                  marginRight: '5px',\r\n                  color: statusc\r\n                },\r\n                on: {\r\n                  click: () => {\r\n                    // this.formBean = Object.assign({}, row)\r\n                    // this.formBean.depPlatform = row.platform\r\n                    // this.formBean.depSystem = row.system\r\n                    // this.formBean.depJob = row.job\r\n                    // this.formBean.isEnable = '' + row.isEnable\r\n                    // this.depDlg.index = index\r\n                    // this.showDepDlg()\r\n                  }\r\n                }\r\n              }, row.isEnable != 1 ? '禁用' : '启用')\r\n            ])\r\n          }\r\n        },\r\n        {\r\n          title: '操作',\r\n          width: 80,\r\n          // fixed: 'right',\r\n          key: 'isEnable',\r\n          render: (h, { column, index, row }) => {\r\n            let statusc = '#19be6b'\r\n            if (row.isEnable == '0') {\r\n              statusc = '#ed3f14'\r\n            }\r\n            return h('div', [\r\n              h('a', {\r\n                props: {\r\n                  size: 'small',\r\n                  type: 'info'\r\n                },\r\n                style: {\r\n                  marginRight: '5px'\r\n                  // color: statusc\r\n                },\r\n                on: {\r\n                  click: () => {\r\n                    this.orgIsEnabel = row.isEnable + ''\r\n                    this.orgDepBatch = row.depBatch\r\n                    this.formBean = Object.assign({}, row)\r\n                    this.formBean.depPlatform = row.platform\r\n                    this.formBean.depSystem = row.systems\r\n                    this.formBean.depJob = row.job\r\n                    this.formBean.isEnable = '' + row.isEnable\r\n                    this.formBean.id = row.pid\r\n                    this.depDlg.index = index\r\n                    this.showDepDlg()\r\n                  }\r\n                }\r\n              }, '操作')\r\n            ])\r\n          }\r\n        }\r\n      ],\r\n      // gridData: [{platform: \"BDP\", system: \"DLA\", job: \"BDP_DLA_TEST\",depPlatform: \"BDP\", depSystem: \"DLA\", depJob: \"BDP_DLA_TEST_STREAM\",des:\"ss\",isEnable: \"1\"}],\r\n      selection: [],\r\n      page: {\r\n        current: 1,\r\n        total: 10,\r\n        size: 10,\r\n        opt: [10, 50, 100]\r\n      },\r\n      tablePage: {},\r\n      ruleValidate: {\r\n      },\r\n      jobtypeList: { 'D': '日', 'C': '定时', 'W': '周', 'M': '月' },\r\n      orgIsEnabel: '',\r\n      orgDepBatch: null\r\n    }\r\n  },\r\n  methods: {\r\n    /**\r\n\t\t * 初始化\r\n\t\t **/\r\n    init () {\r\n      if (this.transData.id) {\r\n        if (this.transData.curTab === 'Table') {\r\n          this.tablePage.current = this.transData.currentPage\r\n          this.tablePage.size = this.transData.pageSize\r\n        }\r\n        if (this.transData.tablePage) {\r\n          this.tablePage = this.transData.tablePage\r\n        }\r\n        if (this.transData.prequeryCache) {\r\n          // this.page = this.transData.prequeryCache.page\r\n          this.page.current = this.transData.prequeryCache.currentPage\r\n          this.page.size = this.transData.prequeryCache.pageSize\r\n        }\r\n      }\r\n      this.search()\r\n      // this.queryjobtypeList()\r\n    },\r\n    /**\r\n\t\t * 如果传过来的有初始数据则进行数据绑定\r\n\t\t **/\r\n    bindData () {\r\n      try {\r\n        this.formBean = Object.assign({}, this.transData.initFormBean)\r\n      } catch (error) {\r\n        console.error(error)\r\n      }\r\n    },\r\n    /**\r\n\t\t * 下载\r\n\t\t **/\r\n    download () {\r\n      let params = {}\r\n      Object.assign(params, this.formBean)\r\n      params.type = 'excel'\r\n      params.downloadType = 'dep'\r\n      params.job = this.transData.id\r\n      utils.download(RESOURCE_PATH + '/downLoad', params)\r\n    },\r\n    /**\r\n\t\t * 查询\r\n\t\t **/\r\n    search () {\r\n      let params = {}\r\n      Object.assign(params, this.formBean)\r\n      params.current = this.page.current\r\n      params.size = this.page.size\r\n      params.job = this.transData.id\r\n      // if (!this.transData.formBean) {\r\n      //   params.currentPage = 1\r\n      // }\r\n      if (!params.job) {\r\n        params.job = this.$store.getters.getUmdata('dep')\r\n        this.$store.dispatch('resetUmdata', { path: 'dep' })\r\n      }\r\n      let httpConfig = {\r\n        method: 'GET',\r\n        url: RESOURCE_PATH + '/UpjobList',\r\n        params: params\r\n      }\r\n\r\n      this.$ajax(httpConfig)\r\n        .then(resp => {\r\n          resp.data.records.forEach(data1 => {\r\n            if (data1.depIsEnable) {\r\n              data1.isEnable = '1'\r\n            } else {\r\n              data1.isEnable = '0'\r\n            }\r\n          })\r\n          this.gridData = resp.data.records\r\n          this.page.total = resp.data.total\r\n        })\r\n    },\r\n\r\n    /**\r\n\t\t * 返回到数据视图\r\n\t\t **/\r\n    cancel () {\r\n      let prevTab = ''\r\n      if (this.transData.tabObj) {\r\n        prevTab = this.transData.tabObj.prevTab\r\n        prevTab = 'joblist'\r\n      }\r\n      let queryCache = { formBean: this.transData.formBean, currentPage: this.transData.currentPage, pageSize: this.transData.pageSize }\r\n      let backParam = { statusName: 'table', prevTab: prevTab, type: 'back' }\r\n      if (this.transData.tablePage) {\r\n        queryCache = { formBean: this.transData.formBean, currentPage: this.tablePage.current, pageSize: this.tablePage.size }\r\n      }\r\n      if (this.transData.prequeryCache) {\r\n        if (this.transData.jobStatus) {\r\n          this.transData.prequeryCache.jobStatus = this.transData.jobStatus\r\n        }\r\n        this.$emit('switch', Object.assign({}, this.transData.prequeryCache, backParam))\r\n      } else {\r\n        this.$emit('switch', Object.assign({}, queryCache, backParam, { jobData: this.transData.jobData }))\r\n      }\r\n    },\r\n    showDepDlg () {\r\n      this.depDlg.show = true\r\n    },\r\n    /**\r\n\t\t * 数据复选事件\r\n\t\t **/\r\n    select (selection) {\r\n      this.selection = selection\r\n    },\r\n    /**\r\n\t\t * 改变页码事件\r\n\t\t **/\r\n    changePage (currentPage) {\r\n      this.page.current = currentPage\r\n      this.search()\r\n    },\r\n    /**\r\n\t\t * 改变分页大小事件\r\n\t\t **/\r\n    changePageSize (pageSize) {\r\n      this.page.size = pageSize\r\n      this.search()\r\n    },\r\n    /**\r\n\t\t * 列排序\r\n\t\t **/\r\n    changeSort (column) {\r\n      let classcon = window.event.currentTarget.className\r\n      let sort, order\r\n      if (classcon.indexOf('ivu-icon-md-arrow-dropup') > -1) {\r\n        order = 'ASC'\r\n      } else if (classcon.indexOf('ivu-icon-md-arrow-dropdown') > -1) {\r\n        order = 'DESC'\r\n      }\r\n      // console.log(\"column,key,order\"+ column.key );\r\n      this.formBean.order = order\r\n      this.formBean.sort = column.key\r\n      this.search()\r\n    },\r\n    /**\r\n         * 平台管理员操作权限特殊处理增加判断\r\n         * 禁用启用依赖，仅当角色为平台管理员、平台是该用户拥有的才可以操作\r\n         *\r\n         **/\r\n    isOwnPlatform (job) {\r\n      let authPlatform = this.$store.getters.getPlatforms\r\n      if (authPlatform.indexOf('ROLE_ADMIN') === -1) {\r\n        if (authPlatform.length > 0) {\r\n          if (authPlatform.includes(job.platform)) {\r\n            return true\r\n          } else {\r\n            // 修改的平台不是所属平台\r\n            this.$Message.error({\r\n              content: '操作权限不足，请联系管理员确认！',\r\n              duration: 15,\r\n              closable: true\r\n            })\r\n            return false\r\n          }\r\n        }\r\n      }\r\n      return true\r\n    },\r\n    depOk (row) {\r\n      let params = {}\r\n      // console.log(this.formBean)\r\n      // params.depJob = this.formBean.job\r\n      // params.job = this.transData.jobData.job\r\n      // params.isEnable = this.formBean.isEnable\r\n      // params.depBatch = this.formBean.depBatch\r\n      // params.isChangeEnable = '0'\r\n      // params.authps = this.transData.jobData.platform + this.transData.jobData.system\r\n      params.id = this.formBean.pid\r\n      params.isEnable = this.formBean.isEnable\r\n      let httpConfig = {\r\n        url: RESOURCE_PATH,\r\n        data: params\r\n      }\r\n      // if (!this.isOwnPlatform({ platform: this.transData.jobData.platform })) {\r\n      //   return\r\n      // }\r\n      if (this.transData.id) {\r\n        if (this.orgIsEnabel !== this.formBean.isEnable) {\r\n          params.isChangeEnable = '1'\r\n        }\r\n        // httpConfig.method = 'PUT'\r\n        // httpConfig.url = '/udsjobdependency/' + this.transData.id\r\n        httpConfig.method = 'POST'\r\n        httpConfig.url = '/udsJobDependency/update'\r\n      } else {\r\n        httpConfig.method = 'POST'\r\n      }\r\n      this.$ajax(httpConfig)\r\n        .then(resp => {\r\n          if (resp.status && resp.status == 200) {\r\n            // if (resp.data === 1 && params.isChangeEnable === '1') {\r\n            //   this.$Message.error({\r\n            //     content: '是否启用依赖修改失败！',\r\n            //     duration: 8,\r\n            //     closable: true\r\n            //   })\r\n            // }\r\n            // if (resp.data === 2) {\r\n            //   this.$Message.error({\r\n            //     content: '依赖批次号修改失败！',\r\n            //     duration: 8,\r\n            //     closable: true\r\n            //   })\r\n            // }\r\n            // this.gridData[this.depDlg.index].isEnable = this.formBean.isEnable\r\n            this.search()\r\n          }\r\n          // this.cancel();\r\n        })\r\n      // this.$emit('switch', {statusName: \"dep\"});\r\n    },\r\n    getPageParam () {\r\n      return { formBean: this.formBean,\r\n        currentPage: this.page.current,\r\n        pageSize: this.page.size }\r\n    },\r\n    queryjobtypeList () {\r\n      let loadConfig = {\r\n        method: 'GET',\r\n        url: '/dictionary',\r\n        params: { dicCode: 'jobtype' }\r\n      }\r\n      this.$ajax(loadConfig)\r\n        .then(resp => {\r\n          this.jobtypeList = {}\r\n          resp.data.rows.forEach(data => {\r\n            this.jobtypeList[data.dicValue] = data.dicName\r\n          })\r\n        })\r\n    }\r\n  },\r\n  /**\r\n\t * 视图挂载\r\n\t **/\r\n  mounted () {\r\n    this.init()\r\n  }\r\n}\r\n\r\n</script>\r\n<style>\r\n#depTable table td div{\r\n\t/* padding-left: 5px;\r\n\tpadding-right: 0; */\r\n}\r\n#depTable table th div{\r\n\t/* padding-left: 5px;\r\n\tpadding-right: 0; */\r\n}\r\n#confirmDep .ivu-modal-body{\r\n\tpadding: 16px;\r\n  font-size:14px;\r\n  line-height:1.5;\r\n  width: 100%;\r\n}\r\n</style>\r\n"]}]}