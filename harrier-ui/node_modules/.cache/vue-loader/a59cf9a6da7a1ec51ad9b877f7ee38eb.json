{"remainingRequest":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\spdb\\job\\jobComplement\\Table.vue?vue&type=style&index=0&id=8811c786&lang=css&","dependencies":[{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\spdb\\job\\jobComplement\\Table.vue","mtime":1681468306533},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\r\n#joblistTable table td div{\r\n  padding-left: 2px;\r\n  padding-right: 2px;\r\n}\r\n#joblistTable table th div{\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n",{"version":3,"sources":["Table.vue"],"names":[],"mappings":";AAwbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Table.vue","sourceRoot":"src/view/spdb/job/jobComplement","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"spdb-form\" style=\"margin-top:20px;\">\r\n      <Form ref=\"udsjobForm\" :model=\"formBean\" :label-width=\"80\" :rules=\"ruleValidate\">\r\n        <Row>\r\n          <Col span=\"6\">\r\n            <FormItem label=\"补数名\">\r\n              <Input type=\"textarea\" :autosize=\"{minRows: 1,maxRows: 5}\" v-model=\"formBean.comName\" placeholder=\"支持模糊查询\"/>\r\n            </FormItem>\r\n          </Col>\r\n          <Col span=\"1\">&nbsp;</Col>\r\n          <Col span=\"8\">\r\n            <div class=\"spdb-toolbar\">\r\n              <Button type=\"primary\" icon=\"ios-search\" @click=\"search\">查询</Button>\r\n              <Button type=\"primary\" icon=\"md-close\" @click=\"clear\">清除查询</Button>\r\n            </div>\r\n          </Col>\r\n        </Row>\r\n      </Form>\r\n    </div>\r\n\r\n    <div v-if=\"transData.showTable\" class=\"spdb-table\" id=\"joblistTable\">\r\n      <Table  size=\"small\"  :columns=\"gridColumns\" :data=\"gridData\" stripe @on-selection-change=\"select\" @on-sort-change=\"changeSort\">\r\n      </Table>\r\n    </div>\r\n\r\n    <div v-if=\"transData.showTable\" class=\"spdb-page\">\r\n      <Page placement=\"top\" :total=\"page.total\" :current=\"page.current\" :page-size=\"page.size\" :page-size-opts=\"page.opt\"  show-total show-sizer show-elevator @on-change=\"changePage\" @on-page-size-change=\"changePageSize\" ></Page>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport utils from '@/common/utils'\r\nimport store from '@/store/index'\r\nimport common from '@/mixins/common'\r\nconst RESOURCE_PATH = '/udsComplement'\r\n\r\nexport default {\r\n  mixins: [ common ],\r\n  props: {\r\n    transData: {\r\n      type: Object,\r\n      default: function () {\r\n        return {}\r\n      }\r\n    }\r\n  },\r\n  data: function () {\r\n    return {\r\n      platformData: [],\r\n      systemData: [],\r\n      jobstatusData: [\r\n        { label: 'Done', value: 'Done' },\r\n        { label: 'Pending', value: 'Pending' },\r\n        { label: 'Running', value: 'Running' },\r\n        { label: 'Failed', value: 'Failed' },\r\n        { label: 'Ready', value: 'Ready' }\r\n      ],\r\n      formBean: {},\r\n      udsJobStyle: {\r\n        status: 'black'\r\n      },\r\n      gridColumns: [\r\n        {\r\n          title: '补数名称',\r\n          ellipsis: true,\r\n          minWidth: 150,\r\n          sortable: true,\r\n          key: 'comName'\r\n        },\r\n        {\r\n          title: '开始日期',\r\n          ellipsis: false,\r\n          tooltip: false,\r\n          minWidth: 170,\r\n          sortable: true,\r\n          key: 'startTime'\r\n        },\r\n        {\r\n          title: '结束日期',\r\n          ellipsis: false,\r\n          tooltip: false,\r\n          minWidth: 170,\r\n          sortable: true,\r\n          key: 'endTime',\r\n          render: (h, { column, index, row }) => {\r\n            let endArr = ['', '']\r\n            if (row.endTime) {\r\n              endArr = row.endTime.split(' ')\r\n            }\r\n            return h('div', [\r\n              h('div', {\r\n                props: {\r\n                  size: 'small',\r\n                  type: 'info'\r\n                },\r\n                style: {\r\n                  // marginRight: '5px'\r\n                }\r\n              }, row.lastStatus === 'Running' ? '' : row.endTime)])\r\n          }\r\n        },\r\n        {\r\n          title: '补数状态',\r\n          ellipsis: true,\r\n          tooltip: true,\r\n          minWidth: 80,\r\n          maxWidth: 100,\r\n          sortable: true,\r\n          key: 'lastStatus'\r\n        },\r\n        {\r\n          title: '批次范围',\r\n          ellipsis: true,\r\n          tooltip: true,\r\n          minWidth: 80,\r\n          maxWidth: 100,\r\n          sortable: true,\r\n          key: 'batchRange'\r\n        },\r\n        {\r\n          title: '服务器范围',\r\n          ellipsis: false,\r\n          tooltip: true,\r\n          minWidth: 110,\r\n          maxWidth: 130,\r\n          sortable: true,\r\n          key: 'serverNameRang'\r\n        },\r\n        {\r\n          title: '作业并行数',\r\n          ellipsis: false,\r\n          tooltip: true,\r\n          minWidth: 110,\r\n          maxWidth: 130,\r\n          sortable: true,\r\n          key: 'maxRunJob'\r\n        },\r\n        {\r\n          title: '详情',\r\n          width: 80,\r\n          align: 'center',\r\n          // fixed: 'right',\r\n          render: (h, { column, index, row }) => {\r\n            return h('div', [\r\n              h('Button', {\r\n                props: {\r\n                  icon: 'md-reorder'\r\n                },\r\n                style: {\r\n                  margin: '0px',\r\n                  fontSize: '20px',\r\n                  border: 0,\r\n                  padding: '4px 8px',\r\n                  color: '#03399b',\r\n                  backgroundColor: 'transparent'\r\n                },\r\n                on: {\r\n                  click: () => {\r\n                    let id = row.complementId\r\n                    this.$emit('switch', Object.assign({}, { id: id, jobData: row, statusName: 'jobComplement', curTab: 'Table' }, this.getPageParam())) // 提交form事件，在parent中显示form\r\n                  }\r\n                }\r\n              }, '')\r\n            ])\r\n          }\r\n        },\r\n      ],\r\n      gridData: [],\r\n      selection: [],\r\n      page: {\r\n        current: 1,\r\n        total: 10,\r\n        size: 10,\r\n        opt: [10, 50, 100]\r\n      },\r\n      ruleValidate: {\r\n        // platform: [\r\n        //   { validator: validatePlatform, trigger: 'change' }\r\n        // ]\r\n      },\r\n      fromto: '1'\r\n    }\r\n  },\r\n  methods: {\r\n    /**\r\n     * 初始化\r\n     **/\r\n    init () {\r\n      if (this.transData.currentPage) {\r\n        this.formBean = this.transData.formBean\r\n        this.page.current = this.transData.currentPage\r\n        this.page.size = this.transData.pageSize\r\n      }\r\n\r\n      if (window.sessionStorage.getItem('joblist_jobcomplement') || this.transData.jobStatus) {\r\n        this.fromto = '0'\r\n        // this.transData.jobStatus\r\n        if (window.sessionStorage.getItem('joblist_jobcomplement') == '0') {\r\n          this.formBean.enable = 0\r\n        } else {\r\n          this.formBean.enable = 1\r\n          if (this.transData.formBean && (this.transData.formBean.lastStatus ||\r\n          this.transData.formBean.lastStatus.length == 0)) { this.formBean.lastStatus = this.transData.formBean.lastStatus } else { this.formBean.lastStatus = window.sessionStorage.getItem('joblist_jobcomplement') }\r\n          if (this.transData.jobData) {\r\n            this.formBean.platform = this.transData.jobData.platform\r\n          }\r\n        }\r\n      }\r\n    },\r\n    /**\r\n         * 如果传过来的有初始数据则进行数据绑定\r\n         **/\r\n    bindData (fields) {\r\n      try {\r\n        const data = Object.assign({}, this.transData.initFormBean)\r\n        if (fields) { // 进行可选字段初始化\r\n          for (const field of fields) {\r\n            this.formBean[field] = data[field]\r\n          }\r\n        } else { // 进行全量字段初始化（默认是只有主表的主键的）\r\n          this.formBean = Object.assign({}, data)\r\n        }\r\n      } catch (error) {\r\n        console.error(error)\r\n      }\r\n    },\r\n\r\n    /**\r\n     * 查询\r\n     **/\r\n    search () {\r\n      if (\r\n        window.sessionStorage.getItem('joblist_jobcomplement') ||\r\n                this.transData.jobStatus\r\n      ) {\r\n        let prevTab = ''\r\n        let backParam = {}\r\n        if (this.transData.statusName === 'table') {\r\n          backParam.statusName = this.transData.prevTab\r\n        } else {\r\n          backParam.statusName = this.transData.statusName\r\n        }\r\n        backParam.udsjobsearch = '1'\r\n        this.$emit('switch', Object.assign({}, backParam))\r\n      } else {\r\n        this.$emit(\r\n          'switch',\r\n          Object.assign({}, { statusName: 'table' })\r\n        )\r\n      }\r\n      let params = {}\r\n      if (this.formBean.comName) {\r\n        params.comName = this.formBean.comName\r\n      }\r\n      params.current = this.page.current\r\n      params.size = this.page.size\r\n      for (let key in params) {\r\n        if (key === 'job') {\r\n          if (params[key] && params[key] !== '') {\r\n            params[key] = '%' + params[key].trim().toUpperCase() + '%'\r\n          } else {\r\n            delete params[key]\r\n          }\r\n        }\r\n        if (key === 'systems' && params[key]) {\r\n          params[key] = params[key].trim().toUpperCase()\r\n        }\r\n      }\r\n\r\n      let httpConfig = {\r\n        method: 'GET',\r\n        url: RESOURCE_PATH + '/selectAll',\r\n        params: params\r\n      }\r\n      this.$ajax(httpConfig)\r\n        .then(resp => {\r\n          if (resp.data.total && resp.data.total > 0) {\r\n            if (resp.data.rows && resp.data.rows.length === 0) {\r\n              this.page.current = 1\r\n              this.search()\r\n            }\r\n          }\r\n          this.gridData = resp.data.rows\r\n          this.page.total = resp.data.total\r\n        })\r\n      // })\r\n    },\r\n\r\n    execOpt (flag, row, index, column) {\r\n\r\n    },\r\n    /**\r\n     * 清空\r\n     **/\r\n    clear () {\r\n      this.formBean = {}\r\n      this.selection = []\r\n      this.page = {\r\n        current: 1,\r\n        size: 10\r\n      }\r\n    },\r\n\r\n\r\n\r\n    /**\r\n     * 数据复选事件\r\n     **/\r\n    select (selection) {\r\n      this.selection = selection\r\n    },\r\n    /**\r\n     * 改变页码事件\r\n     **/\r\n    changePage (currentPage) {\r\n      this.page.current = currentPage\r\n      this.search()\r\n    },\r\n    /**\r\n     * 改变分页大小事件\r\n     **/\r\n    changePageSize (pageSize) {\r\n      this.page.size = pageSize\r\n      this.search()\r\n    },\r\n    /**\r\n     * 列排序\r\n     **/\r\n    changeSort (column) {\r\n      let classcon = window.event.currentTarget.className\r\n      let sort, order\r\n      if (classcon.indexOf('ivu-icon-md-arrow-dropup') > -1) {\r\n        order = 'ASC'\r\n      } else if (classcon.indexOf('ivu-icon-md-arrow-dropdown') > -1) {\r\n        order = 'DESC'\r\n      }\r\n      // console.log(\"column,key,order\"+ column.key );\r\n      this.formBean.order = order\r\n      this.formBean.sort = column.key\r\n      this.search()\r\n    },\r\n    getPlatformList () {\r\n      let platformList = this.$store.getters.getUserPlatform()\r\n      platformList.forEach(data => {\r\n        let tmp = {}\r\n        tmp.value = data\r\n        tmp.label = data\r\n        this.platformData.push(tmp)\r\n      })\r\n      this.search()\r\n    },\r\n    // harrier getSystemList\r\n    getSystemList () {\r\n      this.systemData = []\r\n      this.$refs.refsystem.setQuery('')\r\n      if (this.formBean.platform) {\r\n        let userSystemList = this.$store.getters.getUserSystem()\r\n        let userSystem = userSystemList[this.formBean.platform]\r\n        userSystem.forEach(data => {\r\n          let tmp = {}\r\n          tmp.value = data\r\n          tmp.label = data\r\n          this.systemData.push(tmp)\r\n        })\r\n      }\r\n    },\r\n    // harrier test end\r\n    queryPlatform () {\r\n      let loadConfig = {\r\n        method: 'GET',\r\n        url: '/msys/getPlatformList'\r\n      }\r\n      this.$ajax(loadConfig)\r\n        .then(resp => {\r\n          resp.data.forEach(data => {\r\n            let tmp = {}\r\n            tmp.value = data\r\n            tmp.label = data\r\n            this.platformData.push(tmp)\r\n          })\r\n          this.search()\r\n          this.queryJobstatus()\r\n        })\r\n    },\r\n    querySystem () {\r\n      let loadConfig = {\r\n        method: 'GET',\r\n        url: '/msys/getSysList',\r\n        params: { platform: this.formBean.platform }\r\n      }\r\n      this.systemData = []\r\n      this.$refs.refsystem.setQuery('')\r\n      if (this.formBean.platform) {\r\n        this.$ajax(loadConfig)\r\n          .then(resp => {\r\n            resp.data.forEach(data => {\r\n              let tmp = {}\r\n              tmp.value = data\r\n              tmp.label = data\r\n              this.systemData.push(tmp)\r\n            })\r\n          })\r\n      }\r\n    },\r\n    queryJobstatus () {\r\n      let loadConfig = {\r\n        method: 'GET',\r\n        url: '/dictionary',\r\n        params: { dicCode: 'm_job_status' }\r\n      }\r\n      this.$ajax(loadConfig)\r\n        .then(resp => {\r\n          this.jobstatusData = []\r\n          resp.data.rows.forEach(data => {\r\n            let tmp = {}\r\n            tmp.value = data.dicName\r\n            tmp.label = data.dicName\r\n            this.jobstatusData.push(tmp)\r\n            // this.formBean.platform = \"UDS\";\r\n          })\r\n        })\r\n    },\r\n    filterMethod (value, option) {\r\n      return option.toUpperCase().indexOf(value.toUpperCase()) !== -1\r\n    },\r\n    getPageParam () {\r\n      return { formBean: this.formBean,\r\n        currentPage: this.page.current,\r\n        pageSize: this.page.size }\r\n    },\r\n  },\r\n  mounted () {\r\n    this.getPlatformList()\r\n  }\r\n\r\n}\r\n</script>\r\n<style>\r\n#joblistTable table td div{\r\n  padding-left: 2px;\r\n  padding-right: 2px;\r\n}\r\n#joblistTable table th div{\r\n  padding-left: 5px;\r\n  padding-right: 5px;\r\n}\r\n\r\n</style>\r\n"]}]}