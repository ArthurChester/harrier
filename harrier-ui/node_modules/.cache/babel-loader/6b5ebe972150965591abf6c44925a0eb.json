{"remainingRequest":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\components\\main\\components\\user\\user.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\components\\main\\components\\user\\user.vue","mtime":1681468306468},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\.babelrc","mtime":1681468306354},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _defineProperty from \"D:/WorkSpace/IdeaProjects/harrier/harrier-ui/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport \"./user.less\";\nimport utils from '@/common/utils';\nimport { mapActions } from 'vuex';\n// import { RSAKeyPair, encryptedString } from 'speed4j-front-commonjs'\nimport env from '@/config';\nimport { localRemove } from '@/libs/util';\nexport default {\n  data: function data() {\n    return {\n      userChName: '',\n      userMsg: false,\n      oldPassword: '',\n      newPassword: '',\n      newPassword2: '',\n      loading: false,\n      isview: false,\n      key: ''\n    };\n  },\n  name: 'User',\n  props: {},\n  computed: {\n    userName: function userName() {\n      return this.$store.getters.getUserName;\n    }\n  },\n  methods: _objectSpread(_objectSpread({}, mapActions(['handleLogOut'])), {}, {\n    logout: function logout() {\n      var _this = this;\n      // utils.logout(this.$router)\n      localRemove('route');\n      this.handleLogOut().then(function () {\n        _this.$router.push({\n          name: 'login'\n        });\n      });\n    },\n    message: function message() {\n      this.$router.push({\n        name: 'message_page'\n      });\n    },\n    handleClick: function handleClick(name) {\n      switch (name) {\n        case '退出':\n          this.logout();\n          break;\n        case '修改密码':\n          this.userMsg = true;\n          // if (env.enableVerifyPass) {\n          //   this.getKey()\n          // }\n          break;\n      }\n    },\n    getUserName: function getUserName() {\n      // const userconfig = {\n      //   method: 'GET',\n      //   url: '/user',\n      //   params: { username: this.$store.getters.getUser.username }\n      // }\n      // this.$ajax(userconfig).then(resp => {\n      //   if (resp.data.rows) {\n      //     this.userChName = resp.data.rows[0].userchname\n      //   }\n      // })\n      this.userChName = this.$store.getters.getUserChName();\n    },\n    userOk: function userOk() {\n      var _this2 = this;\n      if (this.oldPassword) {\n        if (this.newPassword === this.newPassword2 && !(this.newPassword === this.oldPassword)) {\n          var pwreg = /^(?![S|s]pdb.123)(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[`~!@#$%^&*()_+<>?:\"{},.;'\\/[\\]\\|\\\\=-]).*$/;\n          if (pwreg.test(this.newPassword)) {\n            var params = {};\n            // params.oldPassword = encryptedString(this.key, this.oldPassword)\n            // params.newPassword = encryptedString(this.key, this.newPassword)\n            params.oldPassword = this.oldPassword;\n            params.newPassword = this.newPassword;\n            var httpConfig = {\n              method: 'PUT',\n              url: '/user/updatePwd',\n              params: params\n            };\n            this.loading = true;\n            this.isview = true;\n            this.$ajax(httpConfig).then(function (resp) {\n              if (resp.data === 'success') {\n                _this2.$Message.success('修改成功！');\n                _this2.userCancel();\n              } else if (resp.data === 'pwdfail') {\n                _this2.$Message.error('密码不匹配，修改失败！');\n              } else if (resp.data === 'userfail') {\n                _this2.$Message.error('登录超时，请重新登录！');\n                _this2.logout();\n              } else {\n                _this2.$Message.error('修改失败！');\n              }\n              _this2.loading = false;\n              _this2.isview = false;\n            });\n          } else {\n            this.$Message.error('密码不符合规则,必须是字母数组和特殊字符组合！');\n          }\n        } else {\n          this.$Message.error('两次输入密码不同或新旧密码相同！');\n        }\n      } else {\n        this.$Message.error('请输入旧密码！');\n      }\n    },\n    // getKey: function () {\n    //   // load rsa key 加密传输密码\n    //   this.$ajax({\n    //     url: '/login/key',\n    //     method: 'GET'\n    //   })\n    //     .then(response => {\n    //       if (response.status === 200) {\n    //         // 成功\n    //         this.exponent = response.data.exponent\n    //         this.modulus = response.data.modulus\n    //         this.key = new RSAKeyPair(this.exponent, '', this.modulus)\n    //         // this.isClick = false;\n    //       } else {\n    //         this.$Message.error('请求登录信息异常,等待后台恢复！')\n    //         // this.isClick = true;\n    //         let promise = new Promise(resolve => setTimeout(resolve, 10000))\n    //         promise.then(() => this.getKey())\n    //       }\n    //     })\n    //     // eslint-disable-next-line handle-callback-err\n    //     .catch(error => {\n    //       // console.log(error);\n    //       this.$Message.error('请求登录信息异常,等待后台恢复！')\n    //       // this.isClick = true;\n    //       let promise = new Promise(resolve => setTimeout(resolve, 10000))\n    //       promise.then(() => this.getKey())\n    //     })\n    // },\n    userCancel: function userCancel() {\n      this.userMsg = false;\n      this.oldPassword = '';\n      this.newPassword = '';\n      this.newPassword2 = '';\n    }\n  }),\n  mounted: function mounted() {\n    this.getUserName();\n  }\n};",{"version":3,"names":["utils","mapActions","env","localRemove","data","userChName","userMsg","oldPassword","newPassword","newPassword2","loading","isview","key","name","props","computed","userName","$store","getters","getUserName","methods","_objectSpread","logout","_this","handleLogOut","then","$router","push","message","handleClick","getUserChName","userOk","_this2","pwreg","test","params","httpConfig","method","url","$ajax","resp","$Message","success","userCancel","error","mounted"],"sources":["src/components/main/components/user/user.vue"],"sourcesContent":["<template>\r\n  <div class=\"sys-bar-user\">\r\n    <Dropdown trigger=\"click\" style=\"font-size:14px;\" @on-click=\"handleClick\">\r\n      <a class=\"sys-bar-user-a\" href=\"javascript:void(0)\">\r\n        <Icon type=\"md-person\" class=\"sys-bar-user-a\" style=\"font-size:22px\"></Icon>\r\n        <!-- &nbsp; -->\r\n        <span class=\"sys-bar-user-a\">您好, {{ userChName ? userChName : userName }}</span>\r\n        <!-- &nbsp; -->\r\n        <Icon :size=\"18\" class=\"sys-bar-user-a\" type=\"md-arrow-dropdown\"></Icon>\r\n      </a>\r\n      <DropdownMenu slot=\"list\" class=\"select-menu\">\r\n        <DropdownItem name=\"修改密码\">修改密码</DropdownItem>\r\n        <DropdownItem name=\"退出\">退出</DropdownItem>\r\n      </DropdownMenu>\r\n    </Dropdown>\r\n    <!-- 用户弹窗 -->\r\n    <Modal\r\n\t\t\tv-model=\"userMsg\"\r\n\t\t\ttitle=\"修改密码\"\r\n\t\t\t:mask-closable=\"false\"\r\n\t\t\t>\r\n        <Form>\r\n          <Row type=\"flex\" justify=\"center\">\r\n            <Col span=\"20\">\r\n              <Input type=\"password\" v-model=\"oldPassword\">\r\n                <span slot=\"prepend\" style=\"display: inline-block;width:70px\">旧密码：</span>\r\n              </Input>\r\n            </Col>\r\n          </Row>\r\n          <Row style=\"margin-top:6px\" type=\"flex\" justify=\"center\">\r\n            <Col span=\"20\">\r\n              <Input type=\"password\" v-model=\"newPassword\">\r\n                <span slot=\"prepend\" style=\"display: inline-block;width:70px\">新密码：</span>\r\n              </Input>\r\n            </Col>\r\n          </Row>\r\n          <Row style=\"margin-top:6px\" type=\"flex\" justify=\"center\">\r\n            <Col span=\"20\">\r\n              <Input type=\"password\" v-model=\"newPassword2\">\r\n                <span slot=\"prepend\" style=\"display: inline-block;width:70px\">再次输入：</span>\r\n              </Input>\r\n            </Col>\r\n          </Row>\r\n        </Form>\r\n        <div slot=\"footer\">\r\n          <Button type=\"primary\" :loading=\"loading\" @click=\"userOk\">确定</Button>\r\n          <Button type=\"text\" :disabled=\"isview\" @click=\"userCancel\">取消</Button>\r\n        </div>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport './user.less'\r\nimport utils from '@/common/utils'\r\nimport { mapActions } from 'vuex'\r\n// import { RSAKeyPair, encryptedString } from 'speed4j-front-commonjs'\r\nimport env from '@/config'\r\nimport { localRemove } from '@/libs/util'\r\nexport default {\r\n  data () {\r\n    return {\r\n      userChName: '',\r\n      userMsg: false,\r\n      oldPassword: '',\r\n      newPassword: '',\r\n      newPassword2: '',\r\n      loading: false,\r\n      isview: false,\r\n      key: ''\r\n    }\r\n  },\r\n  name: 'User',\r\n  props: {\r\n  },\r\n  computed: {\r\n    userName () {\r\n      return this.$store.getters.getUserName\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions([\r\n      'handleLogOut'\r\n    ]),\r\n    logout () {\r\n      // utils.logout(this.$router)\r\n      localRemove('route')\r\n      this.handleLogOut().then(() => {\r\n        this.$router.push({\r\n          name: 'login'\r\n        })\r\n      })\r\n    },\r\n    message () {\r\n      this.$router.push({\r\n        name: 'message_page'\r\n      })\r\n    },\r\n    handleClick (name) {\r\n      switch (name) {\r\n        case '退出': this.logout()\r\n          break\r\n        case '修改密码':\r\n          this.userMsg = true\r\n          // if (env.enableVerifyPass) {\r\n          //   this.getKey()\r\n          // }\r\n          break\r\n      }\r\n    },\r\n    getUserName () {\r\n      // const userconfig = {\r\n      //   method: 'GET',\r\n      //   url: '/user',\r\n      //   params: { username: this.$store.getters.getUser.username }\r\n      // }\r\n      // this.$ajax(userconfig).then(resp => {\r\n      //   if (resp.data.rows) {\r\n      //     this.userChName = resp.data.rows[0].userchname\r\n      //   }\r\n      // })\r\n      this.userChName = this.$store.getters.getUserChName()\r\n    },\r\n    userOk () {\r\n      if (this.oldPassword) {\r\n        if (\r\n          this.newPassword === this.newPassword2 &&\r\n        !(this.newPassword === this.oldPassword)\r\n        ) {\r\n          var pwreg = /^(?![S|s]pdb.123)(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[`~!@#$%^&*()_+<>?:\"{},.;'\\/[\\]\\|\\\\=-]).*$/\r\n          if (pwreg.test(this.newPassword)) {\r\n            let params = {}\r\n            // params.oldPassword = encryptedString(this.key, this.oldPassword)\r\n            // params.newPassword = encryptedString(this.key, this.newPassword)\r\n            params.oldPassword = this.oldPassword\r\n            params.newPassword = this.newPassword\r\n            let httpConfig = {\r\n              method: 'PUT',\r\n              url: '/user/updatePwd',\r\n              params: params\r\n            }\r\n            this.loading = true\r\n            this.isview = true\r\n            this.$ajax(httpConfig).then(resp => {\r\n              if (resp.data === 'success') {\r\n                this.$Message.success('修改成功！')\r\n                this.userCancel()\r\n              } else if (resp.data === 'pwdfail') {\r\n                this.$Message.error('密码不匹配，修改失败！')\r\n              } else if (resp.data === 'userfail') {\r\n                this.$Message.error('登录超时，请重新登录！')\r\n                this.logout()\r\n              } else {\r\n                this.$Message.error('修改失败！')\r\n              }\r\n              this.loading = false\r\n              this.isview = false\r\n            })\r\n          } else {\r\n            this.$Message.error('密码不符合规则,必须是字母数组和特殊字符组合！')\r\n          }\r\n        } else {\r\n          this.$Message.error('两次输入密码不同或新旧密码相同！')\r\n        }\r\n      } else {\r\n        this.$Message.error('请输入旧密码！')\r\n      }\r\n    },\r\n    // getKey: function () {\r\n    //   // load rsa key 加密传输密码\r\n    //   this.$ajax({\r\n    //     url: '/login/key',\r\n    //     method: 'GET'\r\n    //   })\r\n    //     .then(response => {\r\n    //       if (response.status === 200) {\r\n    //         // 成功\r\n    //         this.exponent = response.data.exponent\r\n    //         this.modulus = response.data.modulus\r\n    //         this.key = new RSAKeyPair(this.exponent, '', this.modulus)\r\n    //         // this.isClick = false;\r\n    //       } else {\r\n    //         this.$Message.error('请求登录信息异常,等待后台恢复！')\r\n    //         // this.isClick = true;\r\n    //         let promise = new Promise(resolve => setTimeout(resolve, 10000))\r\n    //         promise.then(() => this.getKey())\r\n    //       }\r\n    //     })\r\n    //     // eslint-disable-next-line handle-callback-err\r\n    //     .catch(error => {\r\n    //       // console.log(error);\r\n    //       this.$Message.error('请求登录信息异常,等待后台恢复！')\r\n    //       // this.isClick = true;\r\n    //       let promise = new Promise(resolve => setTimeout(resolve, 10000))\r\n    //       promise.then(() => this.getKey())\r\n    //     })\r\n    // },\r\n    userCancel () {\r\n      this.userMsg = false\r\n      this.oldPassword = ''\r\n      this.newPassword = ''\r\n      this.newPassword2 = ''\r\n    }\r\n  },\r\n  mounted () {\r\n    this.getUserName()\r\n  }\r\n}\r\n</script>\r\n"],"mappings":";;;;;;AAqDA;AACA,OAAAA,KAAA;AACA,SAAAC,UAAA;AACA;AACA,OAAAC,GAAA;AACA,SAAAC,WAAA;AACA;EACAC,IAAA,WAAAA,KAAA;IACA;MACAC,UAAA;MACAC,OAAA;MACAC,WAAA;MACAC,WAAA;MACAC,YAAA;MACAC,OAAA;MACAC,MAAA;MACAC,GAAA;IACA;EACA;EACAC,IAAA;EACAC,KAAA,GACA;EACAC,QAAA;IACAC,QAAA,WAAAA,SAAA;MACA,YAAAC,MAAA,CAAAC,OAAA,CAAAC,WAAA;IACA;EACA;EACAC,OAAA,EAAAC,aAAA,CAAAA,aAAA,KACApB,UAAA,EACA,eACA;IACAqB,MAAA,WAAAA,OAAA;MAAA,IAAAC,KAAA;MACA;MACApB,WAAA;MACA,KAAAqB,YAAA,GAAAC,IAAA;QACAF,KAAA,CAAAG,OAAA,CAAAC,IAAA;UACAd,IAAA;QACA;MACA;IACA;IACAe,OAAA,WAAAA,QAAA;MACA,KAAAF,OAAA,CAAAC,IAAA;QACAd,IAAA;MACA;IACA;IACAgB,WAAA,WAAAA,YAAAhB,IAAA;MACA,QAAAA,IAAA;QACA;UAAA,KAAAS,MAAA;UACA;QACA;UACA,KAAAhB,OAAA;UACA;UACA;UACA;UACA;MACA;IACA;IACAa,WAAA,WAAAA,YAAA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA,KAAAd,UAAA,QAAAY,MAAA,CAAAC,OAAA,CAAAY,aAAA;IACA;IACAC,MAAA,WAAAA,OAAA;MAAA,IAAAC,MAAA;MACA,SAAAzB,WAAA;QACA,IACA,KAAAC,WAAA,UAAAC,YAAA,IACA,OAAAD,WAAA,UAAAD,WAAA,GACA;UACA,IAAA0B,KAAA;UACA,IAAAA,KAAA,CAAAC,IAAA,MAAA1B,WAAA;YACA,IAAA2B,MAAA;YACA;YACA;YACAA,MAAA,CAAA5B,WAAA,QAAAA,WAAA;YACA4B,MAAA,CAAA3B,WAAA,QAAAA,WAAA;YACA,IAAA4B,UAAA;cACAC,MAAA;cACAC,GAAA;cACAH,MAAA,EAAAA;YACA;YACA,KAAAzB,OAAA;YACA,KAAAC,MAAA;YACA,KAAA4B,KAAA,CAAAH,UAAA,EAAAX,IAAA,WAAAe,IAAA;cACA,IAAAA,IAAA,CAAApC,IAAA;gBACA4B,MAAA,CAAAS,QAAA,CAAAC,OAAA;gBACAV,MAAA,CAAAW,UAAA;cACA,WAAAH,IAAA,CAAApC,IAAA;gBACA4B,MAAA,CAAAS,QAAA,CAAAG,KAAA;cACA,WAAAJ,IAAA,CAAApC,IAAA;gBACA4B,MAAA,CAAAS,QAAA,CAAAG,KAAA;gBACAZ,MAAA,CAAAV,MAAA;cACA;gBACAU,MAAA,CAAAS,QAAA,CAAAG,KAAA;cACA;cACAZ,MAAA,CAAAtB,OAAA;cACAsB,MAAA,CAAArB,MAAA;YACA;UACA;YACA,KAAA8B,QAAA,CAAAG,KAAA;UACA;QACA;UACA,KAAAH,QAAA,CAAAG,KAAA;QACA;MACA;QACA,KAAAH,QAAA,CAAAG,KAAA;MACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACAD,UAAA,WAAAA,WAAA;MACA,KAAArC,OAAA;MACA,KAAAC,WAAA;MACA,KAAAC,WAAA;MACA,KAAAC,YAAA;IACA;EAAA,EACA;EACAoC,OAAA,WAAAA,QAAA;IACA,KAAA1B,WAAA;EACA;AACA"}]}