{"remainingRequest":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\babel-loader\\lib\\index.js!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\spdb\\job\\jobList\\jobimgs\\lineage.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\src\\view\\spdb\\job\\jobList\\jobimgs\\lineage.vue","mtime":1681468306541},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\.babelrc","mtime":1681468306354},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\WorkSpace\\IdeaProjects\\harrier\\harrier-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport elementResizeDetectorMaker from 'element-resize-detector';\nexport default {\n  props: {\n    transData: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {\n      // platformCnt: 0,\n      systemCnt: -1,\n      jobCnt: -1,\n      nodeColors: [\n      // { color: '#187a2f' }, { color: '#5e9a80' },\n      {\n        color: '#0aa3b5'\n      }, {\n        color: '#76c0cb'\n      }, {\n        color: '#9db2b7'\n      }, {\n        color: '#caa465'\n      }, {\n        color: '#be8663'\n      }, {\n        color: '#dd4c51'\n      }, {\n        color: '#d45a59'\n      }, {\n        color: '#d0545f'\n      }, {\n        color: '#e75b68'\n      }, {\n        color: '#f37674'\n      }, {\n        color: '#f7a128'\n      }, {\n        color: '#ebb40f'\n      }, {\n        color: '#e1c315'\n      }, {\n        color: '#b09733'\n      }, {\n        color: '#a2b029'\n      }, {\n        color: '#3aa255'\n      }],\n      graph: null,\n      option: {\n        tooltip: {\n          formatter: function formatter(value) {\n            return value.name;\n          }\n        },\n        series: {\n          type: 'sunburst',\n          center: ['50%', '50%'],\n          radius: [0, '95%'],\n          // 半径\n          // sort: null,\n          emphasis: {\n            itemStyle: {\n              focus: 'ancestor' // descendant ancestor\n            }\n          },\n\n          levels: [{}, {\n            r0: '15%',\n            r: '55%',\n            itemStyle: {\n              borderWidth: 4\n            }\n          }, {\n            r0: '55%',\n            r: '60%',\n            itemStyle: {\n              borderWidth: 4\n            },\n            label: {\n              color: '#2f4554',\n              position: 'outside',\n              padding: 3\n              // silent: false\n            }\n          }],\n\n          data: this.jobLineageData,\n          label: {\n            rotate: 'radial',\n            formatter: function formatter(param) {\n              var depth = param.treePathInfo.length;\n              if (depth === 3) {\n                var jobNameEn = param.name;\n                // return jobNameEn\n                // let jobNameEn = ''\n                var half = jobNameEn.length / 2;\n                return jobNameEn.substring(0, half) + '\\n' + jobNameEn.substring(half);\n              }\n            }\n          }\n        }\n      }\n    };\n  },\n  methods: {\n    init: function init() {\n      this.graph = this.$echarts.init(document.getElementById('maind'));\n      this.getData(this.transData.jobData);\n    },\n    getData: function getData(jobData) {\n      var _this2 = this;\n      var params = {};\n      params.platform = jobData.platform;\n      // params.system = jobData.system\n      params.job = jobData.job;\n      var loadConfig = {\n        method: 'GET',\n        url: '/jobimg/upjobs',\n        params: params\n      };\n      this.$ajax(loadConfig).then(function (resp) {\n        _this2.formatData(resp.data);\n      });\n    },\n    formatData: function formatData(upJobData) {\n      this.jobCnt = upJobData.length;\n      var node = [];\n      var index = 0;\n      var systemNameArr = [];\n      if (upJobData) {\n        for (var i = 0; i < upJobData.length; i++) {\n          var platindex = upJobData[i].indexOf('_');\n          var sysindex = upJobData[i].indexOf('_', platindex + 1);\n          var systemName = upJobData[i].substring(platindex + 1, sysindex);\n          index = i;\n          while (index > 17) {\n            index = index - 18;\n          }\n          if (systemNameArr.indexOf(systemName) === -1) {\n            var nodeTemp = {\n              name: systemName,\n              itemStyle: this.nodeColors[index]\n            };\n            systemNameArr.push(systemName);\n            node.push(nodeTemp);\n          }\n        }\n        this.systemCnt = systemNameArr.length;\n        this.formatChild(upJobData, node);\n      }\n    },\n    formatChild: function formatChild(upJobData, node) {\n      var _this3 = this;\n      var maxNum = node.length;\n      if (node.length > 10) {\n        // 平台数\n        maxNum = 10;\n      }\n      for (var i = 0; i < maxNum; i++) {\n        var childrenArr = [];\n        var index = 0;\n        for (var j = 0; j < upJobData.length; j++) {\n          var systemName = upJobData[j].substring(upJobData[j].indexOf('_') + 1, upJobData[j].indexOf('_', upJobData[j].indexOf('_') + 1));\n          index = j;\n          while (index > 17) {\n            index = index - 18;\n          }\n          if (node[i].name === systemName) {\n            var obj = {\n              name: upJobData[j],\n              value: 1,\n              itemStyle: this.nodeColors[index]\n            };\n            childrenArr.push(obj);\n            if (childrenArr.length > 2) {\n              // 应用数\n              break;\n            }\n          }\n        }\n        node[i].children = childrenArr;\n      }\n      this.option['series']['data'] = node; // node\n      this.graph.setOption(this.option);\n      window.addEventListener('resize', function () {\n        _this3.graph.resize();\n      });\n      var _this = this;\n      var erd = elementResizeDetectorMaker();\n      erd.listenTo(this.$refs.lineage, function () {\n        _this.$nextTick(function () {\n          _this.graph.resize();\n        });\n      });\n    },\n    getSumData: function getSumData() {\n      var tmp = {};\n      tmp.systemCnt = this.systemCnt;\n      tmp.jobCnt = this.jobCnt;\n      return tmp;\n      // let str = '总共' + this.systemCnt + '个系统' + this.jobCnt + '个作业'\n      // return str\n    }\n  },\n  mounted: function mounted() {\n    this.init();\n  }\n};",{"version":3,"names":["elementResizeDetectorMaker","props","transData","type","Object","default","_default","data","systemCnt","jobCnt","nodeColors","color","graph","option","tooltip","formatter","value","name","series","center","radius","emphasis","itemStyle","focus","levels","r0","r","borderWidth","label","position","padding","jobLineageData","rotate","param","depth","treePathInfo","length","jobNameEn","half","substring","methods","init","$echarts","document","getElementById","getData","jobData","_this2","params","platform","job","loadConfig","method","url","$ajax","then","resp","formatData","upJobData","node","index","systemNameArr","i","platindex","indexOf","sysindex","systemName","nodeTemp","push","formatChild","_this3","maxNum","childrenArr","j","obj","children","setOption","window","addEventListener","resize","_this","erd","listenTo","$refs","lineage","$nextTick","getSumData","tmp","mounted"],"sources":["src/view/spdb/job/jobList/jobimgs/lineage.vue"],"sourcesContent":["<template>\r\n  <div id=\"maind\" ref=\"lineage\" ></div>\r\n</template>\r\n<script>\r\n\r\nimport elementResizeDetectorMaker from 'element-resize-detector'\r\n\r\nexport default {\r\n  props: {\r\n    transData: {\r\n      type: Object,\r\n      default: function () {\r\n        return {}\r\n      }\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      // platformCnt: 0,\r\n      systemCnt: -1,\r\n      jobCnt: -1,\r\n      nodeColors: [ // { color: '#187a2f' }, { color: '#5e9a80' },\r\n        { color: '#0aa3b5' }, { color: '#76c0cb' }, { color: '#9db2b7' }, { color: '#caa465' }, { color: '#be8663' }, { color: '#dd4c51' }, { color: '#d45a59' }, { color: '#d0545f' }, { color: '#e75b68' }, { color: '#f37674' }, { color: '#f7a128' }, { color: '#ebb40f' }, { color: '#e1c315' }, { color: '#b09733' }, { color: '#a2b029' }, { color: '#3aa255' }\r\n      ],\r\n      graph: null,\r\n      option: {\r\n        tooltip: {\r\n          formatter: function (value) {\r\n            return value.name\r\n          }\r\n        },\r\n        series: {\r\n          type: 'sunburst',\r\n          center: ['50%', '50%'],\r\n          radius: [0, '95%'], // 半径\r\n          // sort: null,\r\n          emphasis: {\r\n            itemStyle: {\r\n              focus: 'ancestor' // descendant ancestor\r\n            }\r\n          },\r\n          levels: [{}, {\r\n            r0: '15%',\r\n            r: '55%',\r\n            itemStyle: {\r\n              borderWidth: 4\r\n            }\r\n          }, {\r\n            r0: '55%',\r\n            r: '60%',\r\n            itemStyle: {\r\n              borderWidth: 4\r\n            },\r\n            label: {\r\n              color: '#2f4554',\r\n              position: 'outside',\r\n              padding: 3\r\n              // silent: false\r\n            }\r\n          }],\r\n          data: this.jobLineageData,\r\n          label: {\r\n            rotate: 'radial',\r\n            formatter: function (param) {\r\n              let depth = param.treePathInfo.length\r\n              if (depth === 3) {\r\n                let jobNameEn = param.name\r\n                // return jobNameEn\r\n                // let jobNameEn = ''\r\n                let half = jobNameEn.length / 2\r\n                return jobNameEn.substring(0, half) + '\\n' + jobNameEn.substring(half)\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n    }\r\n  },\r\n  methods: {\r\n    init () {\r\n      this.graph = this.$echarts.init(document.getElementById('maind'))\r\n      this.getData(this.transData.jobData)\r\n    },\r\n    getData (jobData) {\r\n      let params = {}\r\n      params.platform = jobData.platform\r\n      // params.system = jobData.system\r\n      params.job = jobData.job\r\n      let loadConfig = {\r\n        method: 'GET',\r\n        url: '/jobimg/upjobs',\r\n        params: params\r\n      }\r\n      this.$ajax(loadConfig)\r\n        .then(resp => {\r\n          this.formatData(resp.data)\r\n        })\r\n    },\r\n    formatData (upJobData) {\r\n      this.jobCnt = upJobData.length\r\n      let node = []\r\n      let index = 0\r\n      let systemNameArr = []\r\n      if (upJobData) {\r\n        for (let i = 0; i < upJobData.length; i++) {\r\n          let platindex = upJobData[i].indexOf('_')\r\n          let sysindex = upJobData[i].indexOf('_', platindex + 1)\r\n          let systemName = upJobData[i].substring(platindex + 1, sysindex)\r\n          index = i\r\n          while (index > 17) {\r\n            index = index - 18\r\n          }\r\n          if (systemNameArr.indexOf(systemName) === -1) {\r\n            let nodeTemp = { name: systemName, itemStyle: this.nodeColors[index] }\r\n            systemNameArr.push(systemName)\r\n            node.push(nodeTemp)\r\n          }\r\n        }\r\n        this.systemCnt = systemNameArr.length\r\n        this.formatChild(upJobData, node)\r\n      }\r\n    },\r\n    formatChild (upJobData, node) {\r\n      let maxNum = node.length\r\n      if (node.length > 10) { // 平台数\r\n        maxNum = 10\r\n      }\r\n      for (let i = 0; i < maxNum; i++) {\r\n        let childrenArr = []\r\n        let index = 0\r\n        for (let j = 0; j < upJobData.length; j++) {\r\n          let systemName = upJobData[j].substring(upJobData[j].indexOf('_') + 1, upJobData[j].indexOf('_', upJobData[j].indexOf('_') + 1))\r\n          index = j\r\n          while (index > 17) {\r\n            index = index - 18\r\n          }\r\n          if (node[i].name === systemName) {\r\n            let obj = {\r\n              name: upJobData[j],\r\n              value: 1,\r\n              itemStyle: this.nodeColors[index]\r\n            }\r\n            childrenArr.push(obj)\r\n            if (childrenArr.length > 2) { // 应用数\r\n              break\r\n            }\r\n          }\r\n        }\r\n        node[i].children = childrenArr\r\n      }\r\n      this.option['series']['data'] = node// node\r\n      this.graph.setOption(this.option)\r\n      window.addEventListener('resize', () => {\r\n        this.graph.resize()\r\n      })\r\n      const _this = this\r\n      let erd = elementResizeDetectorMaker()\r\n      erd.listenTo(this.$refs.lineage, () => {\r\n        _this.$nextTick(() => {\r\n          _this.graph.resize()\r\n        })\r\n      })\r\n    },\r\n    getSumData () {\r\n      let tmp = {}\r\n      tmp.systemCnt = this.systemCnt\r\n      tmp.jobCnt = this.jobCnt\r\n      return tmp\r\n      // let str = '总共' + this.systemCnt + '个系统' + this.jobCnt + '个作业'\r\n      // return str\r\n    }\r\n  },\r\n  mounted () {\r\n    this.init()\r\n  }\r\n}\r\n</script>\r\n"],"mappings":"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"}]}